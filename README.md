[![en](https://img.shields.io/badge/lang-en-red.svg)](README_EN.md)
[![ua](https://img.shields.io/badge/lang-ua-yellow.svg)](README.md)
[![ru](https://img.shields.io/badge/lang-ru-blue.svg)](README_RU.md)

# Captive Portal –¥–ª—è —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç-–ø—Ä–æ–≤–∞–π–¥–µ—Ä—ñ–≤

**–ü—Ä–æ—Å—Ç–∞ —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—è Captive Portal**, –∑–∞–≤–¥–∞–Ω–Ω—è —è–∫–æ–≥–æ ‚Äì –≤—ñ–¥–æ–±—Ä–∞–∑–∏—Ç–∏ —Å—Ç–æ—Ä—ñ–Ω–∫—É-–∑–∞–≥–ª—É—à–∫—É –∫–ª—ñ—î–Ω—Ç–∞–º –∑ –æ–±–º–µ–∂–µ–Ω–∏–º –¥–æ—Å—Ç—É–ø–æ–º –¥–æ —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç—É.

<img src="https://raw.githubusercontent.com/Nekkoy/Captive-Portal/main/img_ua.jpg" width="560" height="380">

---

## üîß –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î

1. –ü—Ä–∏—Å—Ç—Ä—ñ–π –∫–ª—ñ—î–Ω—Ç–∞ –ø—Ä–∏ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—ñ –¥–æ –º–µ—Ä–µ–∂—ñ –ø–µ—Ä–µ–≤—ñ—Ä—è—î –Ω–∞—è–≤–Ω—ñ—Å—Ç—å –¥–æ—Å—Ç—É–ø—É –¥–æ —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç—É —á–µ—Ä–µ–∑ DNS-–∑–∞–ø–∏—Ç–∏ –¥–æ —Å–ø–µ—Ü—ñ–∞–ª—å–Ω–∏—Ö –¥–æ–º–µ–Ω—ñ–≤ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, `www.msftconnecttest.com`, `captive.apple.com`, —Ç–∞ —ñ–Ω).
2. –ú–∏ –ø–µ—Ä–µ—Ö–æ–ø–ª—é—î–º–æ —Ü—ñ –∑–∞–ø–∏—Ç–∏ —Ç–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î–º–æ –Ω–∞ –Ω–∏—Ö –∑ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ DNS-—Å–µ—Ä–≤–µ—Ä–∞ (Unbound), –≤–∫–∞–∑—É—é—á–∏ –Ω–∞ IP Captive Portal.
3. –ö–ª—ñ—î–Ω—Ç —Ä–æ–±–∏—Ç—å HTTP –∑–∞–ø–∏—Ç –ø–æ –æ—Ç—Ä–∏–º–∞–Ω–æ–º—É IP. –Ø–∫—â–æ —Å–µ—Ä–≤–µ—Ä –ø–æ–≤–µ—Ä—Ç–∞—î `HTTP 302 Found` –∑ –ø–æ—Ç—Ä—ñ–±–Ω–æ—é URL - –±—Ä–∞—É–∑–µ—Ä –∫–ª—ñ—î–Ω—Ç–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤—ñ–¥–∫—Ä–∏–≤–∞—î —Å—Ç–æ—Ä—ñ–Ω–∫—É –∑ —Ü–∏–º URL.

---

## üì¶ –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è —Ç–∞ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ nginx —Ç–∞ unbound

#### Debian/Ubuntu:
```bash
apt-get install nginx unbound
```

#### RHEL/CentOS:
```bash
yum install nginx unbound
```

### 2. –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è nginx
#### a. –°—Ç–æ—Ä—ñ–Ω–∫–∞-–∑–∞–≥–ª—É—à–∫–∞
–°–∫–æ–ø—ñ—é–π—Ç–µ —Ñ–∞–π–ª `nginx_captive_portal_page.conf` —É `/etc/nginx/conf.d/`:
```bash
cp -f ./nginx_captive_portal_page.conf /etc/nginx/conf.d/
```
–ó–º—ñ–Ω—ñ—Ç—å –¥–æ–º–µ–Ω–Ω–µ —ñ–º'—è `captiveportal.example.com` –Ω–∞ –≤–∞—à –¥–æ–º–µ–Ω —Ç–∞ –≤—Å—Ç–∞–Ω–æ–≤—ñ—Ç—å SSL-—Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç.

–°—Ç–≤–æ—Ä—ñ—Ç—å –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—é –¥–ª—è —Å—Ç–∞—Ç–∏–∫–∏:
```bash
mkdir -p /var/www/captive_portal
```

–¢–∞ –ø–æ–∫–ª–∞–¥—ñ—Ç—å —Ç—É–¥–∏ HTML-—Ñ–∞–π–ª:
```bash
cp -f ./index.html /var/www/captive_portal/index.html
```

#### b. –†–µ–¥–∏—Ä–µ–∫—Ç
–°–∫–æ–ø—ñ—é–π—Ç–µ —Ñ–∞–π–ª `nginx_captive_portal_redirect.conf` —É —Ç—É —Å–∞–º—É –ø–∞–ø–∫—É:
```bash
cp -f ./nginx_captive_portal_redirect.conf /etc/nginx/conf.d/
```
–ó–∞–º—ñ–Ω—ñ—Ç—å –¥–æ–º–µ–Ω `captiveportal.example.com` –Ω–∞ –≤–∞—à —Ä—è–¥–æ–∫:
```bash
 set $portal_domain captiveportal.example.com;
```

–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç—ñ—Ç—å `nginx`:
```bash
systemctl restart nginx
```

### 3. –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è unbound
–°–∫–æ–ø—ñ—é–π—Ç–µ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ–π–Ω–∏–π —Ñ–∞–π–ª:
```bash
cp -f ./unbound.conf /etc/unbound/
```

–¢–µ–ø–µ—Ä –ø–æ—Ç—Ä—ñ–±–Ω–æ –∑–∞–º—ñ–Ω–∏—Ç–∏ –≤ –∫–æ–Ω—Ñ—ñ–∑—ñ IP –∞–¥—Ä–µ—Å—É Captive Portal
–î–ª—è —Ü—å–æ–≥–æ –≤–∏–∫–æ–Ω–∞—î–º–æ –∫–æ–º–∞–Ω–¥—É –∑–∞–º—ñ–Ω–∏–≤—à–∏ IP `10.0.0.1` –Ω–∞ IP —Å–≤–æ–≥–æ Captive Portal
```bash
sed -i 's|192\.168\.1\.254|10.0.0.1|g' /etc/unbound/unbound.conf
```

–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç—ñ—Ç—å `Unbound`:
```bash
systemctl restart unbound
```

## üîê –ü–µ—Ä–µ—Ö–æ–ø–ª–µ–Ω–Ω—è DNS –∑–∞–ø–∏—Ç—ñ–≤ —á–µ—Ä–µ–∑ iptables
#### a. –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—è DNS-–∫–ª—ñ—î–Ω—Ç—ñ–≤ –Ω–∞ –ª–æ–∫–∞–ª—å–Ω–∏–π DNS (192.168.1.254) —ñ–∑ –∑–∞–º—ñ–Ω–æ—é –∞–¥—Ä–µ—Å–∏ –Ω–∞ –∞–¥—Ä–µ—Å—É —à–ª—é–∑—É (192.168.1.1)
```bash
iptables -t nat -A PREROUTING -s 192.168.1.0/24 -p udp --dport 53 -j DNAT --to-destination 192.168.1.254:53
iptables -t nat -A PREROUTING -s 192.168.1.0/24 -p tcp --dport 53 -j DNAT --to-destination 192.168.1.254:53
```
#### b. SNAT –¥–ª—è –≤–∏—Ö—ñ–¥–Ω–∏—Ö DNS-–∑–∞–ø–∏—Ç—ñ–≤
```bash
iptables -t nat -A POSTROUTING -p udp -d 192.168.1.254 --dport 53 -j SNAT --to-source 192.168.1.1
iptables -t nat -A POSTROUTING -p tcp -d 192.168.1.254 --dport 53 -j SNAT --to-source 192.168.1.1
```

## üîí –û–±–º–µ–∂–µ–Ω–Ω—è –¥–ª—è –∫–ª—ñ—î–Ω—Ç—ñ–≤
–î–ª—è –∫–æ—Ä–µ–∫—Ç–Ω–æ—ó —Ä–æ–±–æ—Ç–∏ Captive Portal –∫–ª—ñ—î–Ω—Ç–∏ –ø–æ–≤–∏–Ω–Ω—ñ –±—É—Ç–∏ –æ–±–º–µ–∂–µ–Ω—ñ —Ç–∞–∫–∏–º —á–∏–Ω–æ–º:

1. –î–æ–∑–≤–æ–ª–µ–Ω–æ:
 - DNS (UDP/TCP 53)
 - HTTP (80) —Ç–∞ HTTPS (443) –¥–æ—Å—Ç—É–ø —Ç—ñ–ª—å–∫–∏ –¥–æ:
   - Captive Portal
   - –û—Å–æ–±–∏—Å—Ç–∏–π –∫–∞–±—ñ–Ω–µ—Ç
   - –ü–ª–∞—Ç—ñ–∂–Ω—ñ —Å–∏—Å—Ç–µ–º–∏ —Ç–∞ —ñ–Ω—à—ñ ¬´–±—ñ–ª—ñ¬ª —Å–∞–π—Ç–∏

2. –ó–∞–±–æ—Ä–æ–Ω–µ–Ω–æ:
 - HTTP(S) –¥–æ—Å—Ç—É–ø –¥–æ —ñ–Ω—à–∏—Ö —Ö–æ—Å—Ç—ñ–≤ –≤ —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç—ñ
